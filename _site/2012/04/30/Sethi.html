

  <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Additional sources of noise (Sethi 2005)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/assets/css/bootstrap.css" rel="stylesheet">
    <link href="/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/assets/css/solarized.css" rel="stylesheet">
    <link href="/assets/css/docs.css" rel="stylesheet">
  </head>
  <body> 

    <!-- Navbar
    ================================================== -->

   
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class=""><a href="/index.html">Home</a></li>
              <li><a href="/vita.html">Vita</a></li>
              <li><a href="/research.html">Research</a></li>
              <li><a href="/teaching.html">Teaching</a></li>
              <li><a href="/lab-notebook.html">Lab Notebook</a></li>
            </ul>
          </div><!--/.nav-collapse -->
           <form class="navbar-search pull-right" method="get" action="http://google.com/search">
             <input type="hidden" name="q" value="site:carlboettiger.info">
             <input type="text" class="search-query" name="q">
             <button type="submit" class="btn btn-inverse">Search</button>
           </form>
        </div>
      </div>
    </div>




    <div class="container">

<!-- Masthead
================================================== -->
 
<header>
    <h1 class="entry-title">Additional sources of noise (Sethi 2005)</h1>
    <h3></h3>
</header>
<hr class="soften">





      <div class="row-fluid">
        <div class="span8">
          <h1 id="toc_11">Sethi Model</h1>

<ul>
<li>author Carl Boettiger, <a href="mailto:cboettig@gmail.com">cboettig@gmail.com</a></li>
<li>license: CC0</li>
</ul>

<p>Implements a numerical version of the SDP described in (Sethi <em>et. al.</em> 2005).</p>

<p>Clear the workspace and load package dependencies: </p>

<p>Define noise parameters </p>
<div class="highlight"><pre><code class="r">sigma_g <span class="o">&lt;-</span> <span class="m">0.1</span>    <span class="c1"># Noise in population growth</span>
sigma_m <span class="o">&lt;-</span> <span class="m">0.1</span>     <span class="c1"># noise in stock assessment measurement</span>
sigma_i <span class="o">&lt;-</span> <span class="m">0.1</span>     <span class="c1"># noise in implementation of the quota</span>
</code></pre>
</div>

<p>we&#39;ll use log normal noise functions. 
For Reed, only <code>z_g</code> will be random.
Sethi et al will add the other forms of noise: </p>
<div class="highlight"><pre><code class="r">z_g <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> rlnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span>  <span class="m">0</span><span class="p">,</span> sigma_g<span class="p">)</span> <span class="c1"># mean 1</span>
z_m <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> rlnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span>  <span class="m">0</span><span class="p">,</span> sigma_m<span class="p">)</span> <span class="c1"># mean 1</span>
z_i <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> rlnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span>  <span class="m">0</span><span class="p">,</span> sigma_i<span class="p">)</span> <span class="c1"># mean 1</span>
</code></pre>
</div>

<p>Chose the state equation / population dynamics function</p>
<div class="highlight"><pre><code class="r">f <span class="o">&lt;-</span> BevHolt
</code></pre>
</div>

<p>Note that the <code>pdg_control</code> pacakge already has a definition for the <code>BevHolt</code> function, (typing the function name prints the function)</p>
<div class="highlight"><pre><code class="r">BevHolt
</code></pre>
</div>
<div class="highlight"><pre><code class="text">function (x, h, p) 
{
    x &lt;- max(0, x - h)
    A &lt;- p[1]
    B &lt;- p[2]
    sapply(x, function(x) {
        x &lt;- max(0, x)
        max(0, A * x/(1 + B * x))
    })
}
&lt;environment: namespace:pdgControl&gt;
</code></pre>
</div>

<p>That is, \( f(x,h) = \frac{A x}{1 + B x} \)</p>

<p>Of course we could pass in any custom function of stocksize <code>x</code>, harvest <code>h</code> and parameter vector <code>p</code> in place of <code>BevHolt</code>.  Note that we would need to write this function explicitly so that it can take vector values of <code>x</code> (i.e. uses <code>sapply</code>), an annoying feature of <code>R</code> for users comming from Matlab.  </p>

<p>We must now define parameters for the function.  Note that the positive stationary root of the model is given by \( \frac{A-1}{B} \), which we&#39;ll store for future reference as <code>K</code>.  </p>
<div class="highlight"><pre><code class="r">pars <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">1.5</span><span class="p">,</span> <span class="m">0.05</span><span class="p">)</span>
K <span class="o">&lt;-</span> <span class="p">(</span>pars<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span><span class="o">/</span>pars<span class="p">[</span><span class="m">2</span><span class="p">]</span>
</code></pre>
</div>

<p>and we use a harvest-based profit function with default parameters</p>
<div class="highlight"><pre><code class="r">profit <span class="o">&lt;-</span> profit_harvest<span class="p">(</span>price<span class="o">=</span><span class="m">1</span><span class="p">,</span> c0 <span class="o">=</span> <span class="m">0.01</span><span class="p">)</span> 
</code></pre>
</div>

<p>The <code>profit_harvest</code> function has the form </p>

<p>\[ \Pi = h - \left( c_0  + c_1 \frac{h}{x} \right) \frac{h}{x} \]</p>

<p>conditioned on \( h &gt; x \) and \(x &gt; 0 \).  Note that the R code defines a function from another function using a trick known as a <em>closure</em>.  Again we could write a custom profit function as long as it can take a vector stock size <code>x</code> and a scalar harvest level <code>h</code>.  Details for provided functions can be found in the manual, i.e. <code>?profit_harvest</code>. </p>

<p>Now we must set up the discrete grids for stock size and havest levels (which will use same resolution as for stock), in order to calculate the SDP solution.   Here we set the gridsize to 100.  </p>
<div class="highlight"><pre><code class="r">x_grid <span class="o">&lt;-</span> seq<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">2</span> <span class="o">*</span> K<span class="p">,</span> length <span class="o">=</span> <span class="m">100</span><span class="p">)</span>  
h_grid <span class="o">&lt;-</span> x_grid  
</code></pre>
</div>

<h3 id="toc_12">Calculate the transition matrix (with noise in growth only)</h3>

<p>We calculate the stochastic transition matrix for the probability of going from any state \( x_t \) 
to any other state \( x_t+1 \) the following year, 
for each possible choice of harvest \( h_t \). This provides a look-up table for the dynamic programming calculations.  </p>

<p>In the Sethi case, computing the distribution over multiple sources of noise is actually quite difficult.  Simulation turns out to be more efficient than numerically integrating over each distribution.  This code parallelizes the operation over four cores, but can be scaled to an arbitrary cluster. </p>
<div class="highlight"><pre><code class="r">require<span class="p">(</span>snowfall<span class="p">)</span> 
sfInit<span class="p">(</span>parallel<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> cpu<span class="o">=</span><span class="m">4</span><span class="p">)</span>
SDP_Mat <span class="o">&lt;-</span> SDP_by_simulation<span class="p">(</span>f<span class="p">,</span> pars<span class="p">,</span> x_grid<span class="p">,</span> h_grid<span class="p">,</span> z_g<span class="p">,</span> z_m<span class="p">,</span> z_i<span class="p">,</span> reps<span class="o">=</span><span class="m">999</span><span class="p">)</span>
</code></pre>
</div>
<div class="highlight"><pre><code class="text">Library ggplot2 loaded.
</code></pre>
</div>

<p>Note that <code>SDP_Mat</code> is specified from the calculation above, as are our grids and our profit function. <code>OptTime</code> is the stopping time.  <code>xT</code> specifies a boundary condition at the stopping time. A reward for meeting this boundary must be specified for it to make any difference.  <code>delta</code> indicates the economic discount rate. Again, details are in the function documentation.   </p>

<h3 id="toc_13">Find the optimum by dynamic programming</h3>

<p>Bellman&#39;s algorithm to compute the optimal solution for all possible trajectories. </p>
<div class="highlight"><pre><code class="r">opt <span class="o">&lt;-</span> find_dp_optim<span class="p">(</span>SDP_Mat<span class="p">,</span> x_grid<span class="p">,</span> h_grid<span class="p">,</span> OptTime<span class="o">=</span><span class="m">25</span><span class="p">,</span> xT<span class="o">=</span><span class="m">0</span><span class="p">,</span> 
                     profit<span class="p">,</span> delta<span class="o">=</span><span class="m">0.05</span><span class="p">,</span> reward<span class="o">=</span><span class="m">0</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="toc_14">Simulate</h3>

<p>Now we&#39;ll simulate 100 replicates of this stochastic process under the optimal harvest policy determined above.</p>
<div class="highlight"><pre><code class="r">sims <span class="o">&lt;-</span> lapply<span class="p">(</span><span class="m">1</span>:<span class="m">100</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span>i<span class="p">){</span>
  ForwardSimulate<span class="p">(</span>f<span class="p">,</span> pars<span class="p">,</span> x_grid<span class="p">,</span> h_grid<span class="p">,</span> x0<span class="o">=</span>K<span class="p">,</span> opt<span class="p">$</span>D<span class="p">,</span> z_g<span class="p">,</span> z_m<span class="p">,</span> z_i<span class="p">)</span>
<span class="p">})</span>
</code></pre>
</div>

<p>The forward simulation algorithm needs an initial condition <code>x0</code> which we set equal to the carrying capacity, as well as our population dynamics <code>f</code>, parameters <code>pars</code>, grids, and noise coefficients.  Recall in the Reed case only <code>z_g</code>, growth, is stochastic, while in the Sethi example we now have three forms of stochasticity -- growth, measurement, and implementation.   </p>

<h2 id="toc_15">Summarize and plot the results</h2>

<p>R makes it easy to work with this big replicate data set.  We make data tidy (melt), fast (data.tables), and nicely labeled.</p>
<div class="highlight"><pre><code class="r">dat <span class="o">&lt;-</span> melt<span class="p">(</span>sims<span class="p">,</span> id<span class="o">=</span>names<span class="p">(</span>sims<span class="p">[[</span><span class="m">1</span><span class="p">]]))</span>  
dt <span class="o">&lt;-</span> data.table<span class="p">(</span>dat<span class="p">)</span>
setnames<span class="p">(</span>dt<span class="p">,</span> <span class="s">&quot;L1&quot;</span><span class="p">,</span> <span class="s">&quot;reps&quot;</span><span class="p">)</span> <span class="c1"># names are nice</span>
</code></pre>
</div>

<h3 id="toc_16">Plots</h3>

<p>Let&#39;s begin by looking at the dynamics of a single replicate. The line shows Reed&#39;s S, the level above which the stock should be harvested (where catch should be the difference between stock and S).  To confirm that this policy is being followed, note that harvesting only occurs when the stock is above this line, and harvest is proportional to the amount by which it is above.  Change the replicate <code>reps==</code> to see the results from a different replicate.  </p>
<div class="highlight"><pre><code class="r">ggplot<span class="p">(</span>subset<span class="p">(</span>dt<span class="p">,</span>reps<span class="o">==</span><span class="m">1</span><span class="p">))</span> <span class="o">+</span>
  geom_line<span class="p">(</span>aes<span class="p">(</span>time<span class="p">,</span> fishstock<span class="p">))</span> <span class="o">+</span>
  geom_abline<span class="p">(</span>intercept<span class="o">=</span>opt<span class="p">$</span>S<span class="p">,</span> slope <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="o">+</span>
  geom_line<span class="p">(</span>aes<span class="p">(</span>time<span class="p">,</span> harvest<span class="p">),</span> col<span class="o">=</span><span class="s">&quot;darkgreen&quot;</span><span class="p">)</span> 
</code></pre>
</div>

<p><img src="http://farm9.staticflickr.com/8007/7130135757_09c23e3e5a_o.png" alt="plot of chunk onerep"> </p>

<p>This plot summarizes the stock dynamics by visualizing the replicates. Reed&#39;s S shown again.</p>
<div class="highlight"><pre><code class="r">p1 <span class="o">&lt;-</span> ggplot<span class="p">(</span>dt<span class="p">)</span> <span class="o">+</span> geom_abline<span class="p">(</span>intercept<span class="o">=</span>opt<span class="p">$</span>S<span class="p">,</span> slope <span class="o">=</span> <span class="m">0</span><span class="p">)</span> 
p1 <span class="o">+</span> geom_line<span class="p">(</span>aes<span class="p">(</span>time<span class="p">,</span> fishstock<span class="p">,</span> group <span class="o">=</span> reps<span class="p">),</span> alpha <span class="o">=</span> <span class="m">0.2</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="http://farm9.staticflickr.com/8148/6984061776_d15e7d073f_o.png" alt="plot of chunk all"> </p>

<p>We can also look at the harvest dynamics:</p>
<div class="highlight"><pre><code class="r">p1 <span class="o">+</span> geom_line<span class="p">(</span>aes<span class="p">(</span>time<span class="p">,</span> harvest<span class="p">,</span> group <span class="o">=</span> reps<span class="p">),</span> alpha <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;darkgreen&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="http://farm8.staticflickr.com/7188/6984052718_6e932cedf8_o.png" alt="plot of chunk harvestplot"> </p>

<p>This strategy is supposed to be a constant-escapement strategy. We can visualize the escapement: </p>
<div class="highlight"><pre><code class="r">p1 <span class="o">+</span> geom_line<span class="p">(</span>aes<span class="p">(</span>time<span class="p">,</span> escapement<span class="p">,</span> group <span class="o">=</span> reps<span class="p">),</span> alpha <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;darkgrey&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="http://farm8.staticflickr.com/7096/6984052922_b4ab50f14b_o.png" alt="plot of chunk escapement"> </p>

<h3 id="toc_17">Visualizing the optimal policy</h3>

<p>Note that when the boundary is sufficiently far away, i.e. for the first couple timesteps, the optimal policy is stationary.  The optimal policy is shown here over time, where the color indicates the harvest recommended for each possible stock value at that time (shown on the vertical axis). Observe that the solution does not correspond to a simple Reed-style rule.  </p>
<div class="highlight"><pre><code class="r">policy <span class="o">&lt;-</span> melt<span class="p">(</span>opt<span class="p">$</span>D<span class="p">)</span>
policy_zoom <span class="o">&lt;-</span> subset<span class="p">(</span>policy<span class="p">,</span> x_grid<span class="p">[</span>Var1<span class="p">]</span> <span class="o">&lt;</span> max<span class="p">(</span>dt<span class="p">$</span>fishstock<span class="p">)</span> <span class="p">)</span>
p5 <span class="o">&lt;-</span> ggplot<span class="p">(</span>policy_zoom<span class="p">)</span> <span class="o">+</span> 
  geom_point<span class="p">(</span>aes<span class="p">(</span>Var2<span class="p">,</span> <span class="p">(</span>x_grid<span class="p">[</span>Var1<span class="p">]),</span> col<span class="o">=</span>h_grid<span class="p">[</span>value<span class="p">]))</span> <span class="o">+</span> 
  labs<span class="p">(</span>x <span class="o">=</span> <span class="s">&quot;time&quot;</span><span class="p">,</span> y <span class="o">=</span> <span class="s">&quot;fishstock&quot;</span><span class="p">)</span> <span class="o">+</span>
  scale_colour_gradientn<span class="p">(</span>colours <span class="o">=</span> rainbow<span class="p">(</span><span class="m">4</span><span class="p">))</span> <span class="o">+</span>
  geom_abline<span class="p">(</span>intercept<span class="o">=</span>opt<span class="p">$</span>S<span class="p">,</span> slope <span class="o">=</span> <span class="m">0</span><span class="p">)</span> 
p5
</code></pre>
</div>

<p><img src="http://farm8.staticflickr.com/7198/7130146133_bf7083f9d2_o.png" alt="plot of chunk policy"> </p>

<p>The harvest intensity is limited by the stock size.</p>
<div class="highlight"><pre><code class="r">p6 <span class="o">&lt;-</span> ggplot<span class="p">(</span>policy_zoom<span class="p">)</span> <span class="o">+</span> 
  geom_point<span class="p">(</span>aes<span class="p">(</span>Var2<span class="p">,</span> <span class="p">(</span>x_grid<span class="p">[</span>Var1<span class="p">]),</span> col<span class="o">=</span>x_grid<span class="p">[</span>Var1<span class="p">]</span> <span class="o">-</span> h_grid<span class="p">[</span>value<span class="p">]))</span> <span class="o">+</span> 
  labs<span class="p">(</span>x <span class="o">=</span> <span class="s">&quot;time&quot;</span><span class="p">,</span> y <span class="o">=</span> <span class="s">&quot;fishstock&quot;</span><span class="p">)</span> <span class="o">+</span>
  scale_colour_gradientn<span class="p">(</span>colours <span class="o">=</span> rainbow<span class="p">(</span><span class="m">4</span><span class="p">))</span> <span class="o">+</span>
  geom_abline<span class="p">(</span>intercept<span class="o">=</span>opt<span class="p">$</span>S<span class="p">,</span> slope <span class="o">=</span> <span class="m">0</span><span class="p">)</span> 
p6 <span class="o">+</span> geom_line<span class="p">(</span>aes<span class="p">(</span>time<span class="p">,</span> fishstock<span class="p">,</span> group <span class="o">=</span> reps<span class="p">),</span> alpha <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span> data<span class="o">=</span>dt<span class="p">)</span>
</code></pre>
</div>

<p><img src="http://farm9.staticflickr.com/8007/6984063036_ea9d9ac47d_o.png" alt="plot of chunk policy2"> </p>

<h1 id="toc_18">References</h1>

<p>Sethi G, Costello C, Fisher A, Hanemann M and Karp L (2005).
&quot;Fishery management under multiple uncertainty.&quot; <em>Journal of
Environmental Economics and Management</em>, <em>50</em>. ISSN 00950696,
<a href="http://dx.doi.org/10.1016/j.jeem.2004.11.005">http://dx.doi.org/10.1016/j.jeem.2004.11.005</a></p>

        </div>


        <!-- Custom sidebar -->      
        <div class="span4">
          <div class="sidebar">
            Posted on
            <time pubdate datetime="2012-04-30T00:00:00-07:00" itemprop="datePublished">30 April 2012</time>. <br />
            <span itemprop="keywords">
            
              <a rel="tag" class="tag" href="/tags.html#decision-theory-tag">#decision-theory</a>
              
            
          </span>
          <br />
          <br />
          
          <p>Previous: <a href='/2012/04/27/evolution-notes.html'>Project tracking (Evolution)</a></p>
          <br />
          
          
          <p>Next: <a href='/2012/05/01/Jekyll-vs-Wordpress.html'>Jekyll vs Wordpress</a></p>
          

          </div>
        </div>
      </div>

        <!-- Disqus Comments -->
      <div class="row">
        <div class="span8">          
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'cboettig'; // required: replace example with your forum shortname
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
      </div>



        <footer class="footer">
         <div class="row">
            <div class="span4">
              <a href="mailto:cboettig@gmail.com"><i class="icon-envelope"></i></a>
              <a href="https://twitter.com/cboettig"><img src="/assets/img/icon-twitter.png" alt="twitter"> </a> 
              <a href="https://github.com/cboettig"><img src="/assets/img/icon-github.png" alt="github"></a> 
              <a href="/atom.xml"><img src="/assets/img/icon-rss.png" alt="feed"></a>
            </div>
            <div class="span2" style="text-align:center">
              <a rel="license" href="http://onsclaims.wikispaces.com/"><img src="http://onsclaims.wikispaces.com/file/view/ons-aci2-icon.png" alt="ONS"></a> <br><br>
              <p> <a class="btn btn-mini" href="https://github.com/cboettig/labnotebook">view logs</a></p>
            </div>
            <div class="span4">
              <a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/"><img src="http://i.creativecommons.org/l/zero/1.0/88x31.png" alt="CC0" style="float:right"></a> 
            </div>
        </div>
      </footer>
    </div><!-- /container -->
    
        <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- Equations using MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });       </script>
    <script src="/assets/js/jquery.js"></script>
    <script src="/assets/js/bootstrap-collapse.js"></script>
    <!--
    <script src="/assets/js/bootstrap-dropdown.js"></script>
    <script src="/assets/js/google-code-prettify/prettify.js"></script>
    <script src="/assets/js/bootstrap-transition.js"></script>
    <script src="/assets/js/bootstrap-alert.js"></script>
    <script src="/assets/js/bootstrap-modal.js"></script>
    <script src="/assets/js/bootstrap-scrollspy.js"></script>
    <script src="/assets/js/bootstrap-tab.js"></script>
    <script src="/assets/js/bootstrap-tooltip.js"></script>
    <script src="/assets/js/bootstrap-popover.js"></script>
    <script src="/assets/js/bootstrap-button.js"></script>
    <script src="/assets/js/bootstrap-carousel.js"></script>
    <script src="/assets/js/bootstrap-typeahead.js"></script>
    <script src="/assets/js/application.js"></script>
    -->


      <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-18401403-1']);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
  </script>

<!--  UA-29776516-1 -->

  </body>
</html>

